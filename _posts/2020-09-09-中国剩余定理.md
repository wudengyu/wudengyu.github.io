---
layout: post
title:  "中国剩余定理"
date:   2020-09-09 01:49:46 +0800
categories: jekyll update
---
中国剩余定理又叫孙子定理，在中国南北朝时期（公元5世纪）的数学著作《孙子算经》卷下第二十六题，叫做“物不知数”问题，原文如下：有物不知其数，三三数之剩二，五五数之剩三，七七数之剩二。问物几何？这个问题实际上是一个同余方程组问题：

$$
\begin{cases}
x\equiv a_1(mod\quad m_1)\\
x\equiv a_2(mod\quad m_2)\\
\nobreakspace\vdots\\
x\equiv a_n(mod\quad m_n)\\
\end{cases}
$$

设\\[M=m_{1}\times m_{2}\times\dots\times m_{n}=\prod_{i=1}^nm_i\\]并设$M_i=M/m_i$，$t_i=M_i^{-1}(mod\space m_i)$，当$m_1，m_2，……，m_n$互质时，方程组的解为：\\[x=\sum_{i=1}^na_it_iM_i(mod\space M)\\]
证明很简单：
$\because$等式$x=a_1t_1M_1+a_2t_2M_2+\dots+a_nt_nM_n$的右边除第$i$项外，都含有因子$m_i$，都能被$m_i$整除。而第$i$项中$t_iM_i\equiv1(mod\space m_i)\therefore x\equiv a_i(mod\space m_i)$也就是说\\[x=\sum_{i=1}^na_it_iM_i\\]满足方程$x\equiv a_i(mod\space m_i)$

问题是，这个解是怎么得来的？还得从简单的问题看起。就以“物不知数”为例，即解如下同余方程组：

$$
\begin{cases}
x\equiv 2(mod\space 3)\dots\dots(1)\\
x\equiv 3(mod\space 5)\dots\dots(2)\\
x\equiv 2(mod\space 7)\dots\dots(3)\\
\end{cases}
$$

方程(1)和方程(3)余数相同，直接可合并为一个方程$x\equiv 2(mod\space 21)\dots\dots(4)$

难点在于余数不一样的。对于余数不一样的，最基本的思路是把它化为余数一样的。对于方程(2)来说，可以表示为$x=k\times5+3=(k\times5+1)+2$，如果把它和方程(4)联立起来解，就只需要$k\times 5+1$能被21整除即可。这个很容易，最小k取4即可，此时得到x=23就是方程组的最小解。

这里很容易就解出来是先两个方程联立化为了一个同解方程，然后只剩另一个方程，这时就可以强行化为余数相同的形式。如果方程组中$a_1、a_2、\dots、a_n$互不相同或不相同的比较多时，这种方法是行不通的。下面不利用两个方程余数相同这一点，寻找更为一般的方法。

对于方程(1)来说，解就是被3除余2的数，这样的数当然有很多，比如5、8、11……，可以表示为3r+2的形式。当然，我们希望找到一个合适的r，使得3r+2被5除余3同时被7除2，这实际上还是原方程组，并没有什么变化，显然并没有什么好的方法可以直接计算出合适的r。一个一个去试都比较麻烦，因为验证3r+2是否满足方程(2)、(3)也并不直接。但是验证是否能被5整除或被7整除甚至同时被5和7整除都很简单，除一下看看就行了。当然这样找出来的3r+2并不是方程组的解，因为它仅仅满足方程(1)。但是这个数求出来是有用的，试想，例如我们找到或者猜到了一个答案，验证的话是不是得用3除一下、用5除一下、用7除一下再看看余数是否满足各个方程。如果找到一个形如3r+2同时又能被5和7整除的数，虽然它只能满足方程(1)，但是在验证方程(2)、(3)的时候就好像不存在一样（余数是0）。也就是说，如果只是把它作为解的一部分，加在别的数上，比如说加在一个除5余3的数8上，它并不会影响余数，除5仍然是余3。也就是说，如果a%b=c，则，(a+kb)%b=c。同样，在考查方程(2)的解时，我们找形如5s+3同时又能被3和7整除的数，这样的数与方程(1)的解相加，同样不会影响方程(1)的解，同样地，对于方程(3)我们就找形如7t+2且能被3和5整除的数……一般地，对第(i)个方程，我们就去找满足方程(i)且能被$a_1\cdot a_2\dots\cdot a_j\dots\cdot a_n(j\in[1,n],j\neq i)$整除的数。这些数全部找出来后，加起来，就是方程组的一个解。比如前面的例子，35就是满第(1)个条件的数，63满足第(2)个方程且又能被3和7整除，30就是既满足第(3)个方程又能被3和5整除，它们的和128就是方程组的一个解。显然$x+k\cdot 105(3、5、7的最小公倍数)$都是方程组的解，其中最小的正整数解应该是128-105=23，这个解在mod 105的意义下是唯一的。

下面看一看能不能不用遍历法来找既满足$x\equiv a_i(mod\space m_i)$又能被$M_i$整除的数（$M_i$的意义同前，表示除$a_i$外其余模数的积）。显然，此时$x=p\cdot m_i+a_i=q\cdot M_i$，因为$m_i$与$M_i$是互质的，用扩展欧几里得算法（其实就是辗转相除法）求解$p\cdot m_i+q\cdot M_i=1$是没有问题的，再乘以$a_i$不难得到x。这里稍稍作了一点变型。还是以实例说明一下。比如，要找除以3以2且能同时被5和7整除（也就是能被35整除）的数，用辗转相除法，可以得到$12\times 3+(-1)\times 35=1$，在模3的情况下就有$2\times 35=23\times 3+1$，也就是找到了35在mod 3时的乘法逆元是2，然后，在等式两边同时乘2就可得到$p\equiv 4(mod\space 3)\equiv 1(mod \space 3)$所以此时方程(1)的解就是$1\times 35=35$。对应的，对于通式$p\cdot m_i+a_i=q\cdot M_i$，先计算出$M_i$模$m_i$的逆元$t_i$，然后两边同时乘上逆元$t_i$，则可得到$q=a_i\cdot t_i(mod\space m_i)$这时方程的解就是$a_i\cdot t_i\cdot M_i(mod\space m_i)$这样就得到了中国剩余定理。

对于较小的数字，遍历很容易求解，所以很难想到用逆元的办法。但是对于较大的数，辗转相除求逆元是肯定可以并且应该是比遍历更快的。通式（公式）的推导不用逆元就难以解释了。

宋朝数学家秦九韶于1247年《数书九章》卷一、二《大衍类》对“物不知数”问题做出了完整系统的解答。明朝数学家程大位将解法编成易于上口的《孙子歌诀》：

三人同行七十稀，五树梅花廿一支，七子团圆正半月，除百零五使得知

这个歌诀给出了模数为3、5、7时候的同余方程的秦九韶解法。意思是：将除以3得到的余数乘以70，将除以5得到的余数乘以21，将除以7得到的余数乘以15，全部加起来后除以105（或者105的倍数），得到的余数就是答案。这里面的70就是35乘以35模3的逆元2得到的。而后面只乘21和15是因为21模5的逆元就是1，15模7的逆元还是1。