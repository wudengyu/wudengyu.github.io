---
layout: post
title:  "Windows 7 SP1不能更新的问题"
date:   2016-10-20 22:58:17 +0800
categories: jekyll update
---
重新装了一个Win7SP1，按习惯，先连上网，然后激活，开启自动更新，再慢慢装其他的。但是其他软件都装得差不多了才发现1个更新都没有，开着机一个中午也一样，一直在“正在查找更新”不会变，记得上次装WIN7的时候自动发现更新有200多个补丁了，现在肯定更多，也许是网速慢吧，也没在意，就开了一个晚上，仍然还是那个界面，这就不正常了。正好，另一台笔记本也要重装系统，就再装了一个，也一样结果，难道微软已经不支持WIN7了么？好像还没到时候啊。上网查了一个，试了很久都没有结果，无奈下载网上打包的累积更新，结果装了几个小时也没装完，最后重启还提示更新失败，回退了。看来还是得走官网更新才稳妥啊。上网查了一个，发现微软本身发布有一个方便汇总更新包KB3125574，包含了SP1发布以来直到2016年4月的更新，如果手工打上这个补丁，那么需要再安装的补丁就会少得多，如果是因为需要打的补丁太多，WSUA处理不过来的话，问题就应该能够解决，结果打这个补丁仍然有检查更新这个环节，仍然卡在那里不动，只有停掉Windows Update服务才安装得上。但是，打好3125574后，检查更新仍然很久没有结果。根据知识库文章，KB3125574需要KB3020369，打上（只有停掉Windows Update服务才行），依旧。再查，网上有说是因为WSUA代理版本低了，如果是原装系统要升级到KB3138612版本是7.6.7601.19161，如果是安装KB3125574之后，版本已经是7.6.7601.23435了，那就要打KB3161608这个2016年6月更新汇总里面包含了新的WSUA，但是知识库说这个更新汇总已经被2016年7月的更新汇总KB3172605替代，那就打KB3172605，结果还是不行。不过，这回很快就会出错，错误代码一会这样，一会那样，照网上说的死马当活马医，关掉防火墙，不行，再上网查，基本上没什么新招数，无非就是停服务、删除%SYSTEMDIR%\SoftwareDistribution下的这样或那样文件夹，这一点我认为要删全部删没错，里面不同的目录无非是下载的临时文件、索引、日志什么的，全部删和只删个别文件差不多。还有说实在不行删%SYSTEMDIR%\SYSTEM32\catroot2目录的，不过我没试。已经没办法了，一遍一遍地停服务、删文件，突然，可以了，发现70个补丁。我感觉其实前面做的其实并没有什么卵用，就是后面停服务、删文件，不停重试有点用，也许根本就没什么问题，仅仅是微软的更新服务器出了问题。不过，这一次折腾也发现了KB3125574这个补丁，原来要打200多个补丁的，打了这一个，只需要打70多个，少太多了。所以记录下来，总结一下新装系统后打补丁的顺序。

1. 先打KB3020369+KB3125574
2. 如果更新有问题，打KB3172605
3. 手工打补丁时如果停在检查更新处，需停掉Windows Update服务（但其实运行补丁程序时会自动启动该服务，但就不会卡在检查更新那里）
4. 如果更新还有问题，就停服务、删除%SYSTEMDIR%\SoftwareDistribution下所有东西试一试，多试几次不行就不要浪费时间了，也许是微软的服务器或网络有问题，过一段时间自己会好。再说，其实也没有什么别的、更好的办法了。